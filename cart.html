<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Giỏ hàng</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background:#f8f9fa; }
h2 { margin-top:0; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; background:#fff; border-radius:8px; overflow:hidden; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
th, td { padding: 12px; border-bottom: 1px solid #eee; text-align:center; vertical-align:middle; }
img { width:80px; height:auto; border-radius:6px; }
button { cursor:pointer; }
input.qty { width:50px; text-align:center; border-radius:6px; border:1px solid #ccc; padding:5px; }
#grand-total { margin-top:20px; font-size:18px; font-weight:bold; }
</style>
</head>
<body>
<h2>Giỏ hàng của bạn</h2>

<table id="cart-table">
  <thead>
    <tr>
      <th>Ảnh</th>
      <th>Sản phẩm</th>
      <th>Giá</th>
      <th>Số lượng</th>
      <th>Tổng</th>
      <th>Lời chúc</th>
      <th>Xóa</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h3 id="grand-total">Tổng cộng: 0₫</h3>

<!-- Popup viết lời chúc -->
<div id="noteModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000;">
  <div style="background:#fff; padding:20px; border-radius:12px; max-width:400px; width:90%; box-shadow:0 4px 15px rgba(0,0,0,0.3);">
    <h3 style="margin-top:0; margin-bottom:10px; font-family:Arial, sans-serif;">Viết lời chúc</h3>
    <textarea id="noteText" rows="5" style="width:100%; padding:10px; font-size:14px; border-radius:8px; border:1px solid #ccc;"></textarea>
    <div style="margin-top:15px; text-align:right;">
      <button onclick="saveNote()" style="padding:8px 15px; margin-right:10px; border:none; background:#28a745; color:#fff; border-radius:6px; cursor:pointer;">Lưu</button>
      <button onclick="closeNoteBox()" style="padding:8px 15px; border:none; background:#dc3545; color:#fff; border-radius:6px; cursor:pointer;">Hủy</button>
    </div>
  </div>
</div>

<script>
// Load giỏ hàng từ localStorage
function loadCart() {
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  const tbody = document.querySelector("#cart-table tbody");
  tbody.innerHTML = "";
  let grandTotal = 0;

  cart.forEach((item, index) => {
    const total = item.price * item.quantity;
    grandTotal += total;

    if(!item.note) item.note = "";

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><img src="${item.image}" alt="${item.name}"></td>
      <td>${item.name}</td>
      <td>${item.price.toLocaleString()}₫</td>
      <td>
        <button onclick="changeQty(${index}, -1)">-</button>
        <input class="qty" type="number" value="${item.quantity}" min="1" onchange="updateQty(${index}, this.value)">
        <button onclick="changeQty(${index}, 1)">+</button>
      </td>
      <td id="total-${index}">${total.toLocaleString()}₫</td>
      <td>
        <button onclick="openNoteBox(${index})" style="padding:5px 10px; border-radius:6px; border:none; background:#007bff; color:#fff; cursor:pointer;">
          Viết lời chúc
        </button>
      </td>
      <td><button onclick="removeItem(${index})" style="padding:5px 10px; border-radius:6px; border:none; background:#dc3545; color:#fff;">Xóa</button></td>
    `;
    tbody.appendChild(tr);
  });

  document.getElementById("grand-total").innerText = `Tổng cộng: ${grandTotal.toLocaleString()}₫`;
}

// Thay đổi số lượng
function changeQty(index, delta) {
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  cart[index].quantity += delta;
  if(cart[index].quantity < 1) cart[index].quantity = 1;
  localStorage.setItem("cart", JSON.stringify(cart));
  loadCart();
}

// Cập nhật số lượng khi input thay đổi
function updateQty(index, value) {
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  cart[index].quantity = parseInt(value) || 1;
  localStorage.setItem("cart", JSON.stringify(cart));
  loadCart();
}

// Xóa sản phẩm
function removeItem(index) {
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  cart.splice(index,1);
  localStorage.setItem("cart", JSON.stringify(cart));
  loadCart();
}

// Modal lời chúc
let currentNoteIndex = null;
function openNoteBox(index) {
  currentNoteIndex = index;
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  const item = cart[index];
  document.getElementById("noteText").value = item.note || "";
  document.getElementById("noteModal").style.display = "flex";
}
function closeNoteBox() {
  document.getElementById("noteModal").style.display = "none";
}
function saveNote() {
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  cart[currentNoteIndex].note = document.getElementById("noteText").value;
  localStorage.setItem("cart", JSON.stringify(cart));
  closeNoteBox();
  loadCart();
}

// Load giỏ hàng khi mở trang
loadCart();
</script>
</body>
</html>
